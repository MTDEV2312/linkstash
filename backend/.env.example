# LinkStash - ejemplo de variables de entorno (backend)
# NO commits secretos en el repositorio. Copia este archivo a `.env` y completa valores seguros.

# Entorno y puerto
NODE_ENV=development		# development | production
PORT=5000

# Base de datos MongoDB
MONGO_URI=mongodb://localhost:27017/linkstash

# JWT / seguridad
JWT_SECRET=change-me-to-a-secure-random-value

# User agent usado por el scraper
USER_AGENT=LinkStash-Bot/1.0

# --- Configuración del scraper (SSRF mitigations) ---
# Lista de hosts permitidos (coma-separada). Ejemplos:
# - example.com  -> sólo example.com
# - .example.com -> example.com y cualquier subdominio (p.ej. blog.example.com)
# En producción: SCRAPER_HOST_ALLOWLIST es OBLIGATORIA (fail-closed). Define aquí los dominios permitidos.
# Ejemplos:
#  - example.com  -> sólo example.com
#  - .example.com -> example.com y cualquier subdominio (p.ej. blog.example.com)
SCRAPER_HOST_ALLOWLIST=example.com,.trusted.net

# Puertos permitidos para scraping (coma-separada). Por defecto sólo 80 y 443.
SCRAPER_ALLOWED_PORTS=80,443

# Timeout en ms para peticiones del scraper
SCRAPER_TIMEOUT_MS=10000

# Tamaño máximo de contenido aceptable (bytes). Default 2MB = 2097152
SCRAPER_MAX_CONTENT_LENGTH=2097152

# Límite de rate (opcional)
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX=60

# Logging
LOG_LEVEL=info

# Modo de operación del scraper
# SCRAPER_ALLOW_PUBLIC=true -> permite scraping de cualquier host público (requiere HTTPS y validaciones anti-SSRF)
# SCRAPER_ALLOW_PUBLIC=false -> sólo permite hosts definidos en SCRAPER_HOST_ALLOWLIST
SCRAPER_ALLOW_PUBLIC=true

# Nota: en entornos de production la aplicación no arrancará si SCRAPER_HOST_ALLOWLIST no está definida.

# Integración opcional con proveedores externos de scraping (si prefieres no ejecutar tu propio scraper)
# Valores posibles: local | apify | scrapingbee (por defecto: local). Muchos proveedores tienen planes gratuitos limitados
# Para usar un proveedor, establece SCRAPER_PROVIDER y la clave correspondiente (ej. APIFY_TOKEN).
APIFY_TOKEN=

# Notas:
# - En producción, además de la allowlist, se recomienda bloquear egress hacia rangos privados
#   (VPC/firewall) y la metadata de la nube (169.254.169.254) a nivel de red.
# - No uses NODE_TLS_REJECT_UNAUTHORIZED=0 en producción; asegura que la validación TLS esté activada.
# - Mantén JWT_SECRET y MONGO_URI en secreto y usa un gestor de secretos en producción.

# Proxy / despliegue
# Si tu servicio se ejecuta detrás de un proxy (p.ej. Render), establece TRUST_PROXY=true
# para que Express use la cabecera X-Forwarded-For al aplicar rate limiting por IP.
TRUST_PROXY=false
